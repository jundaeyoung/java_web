설명

HTTP 통신에 쓰이는 쿠키와 세션에 대해 설명합니다. 

| 키워드                                                       |
| ------------------------------------------------------------ |
| • Connectionless • Stateless • 쿠키 (Cookie) • 세션 (Session) • 세션 하이재킹 (Session Hijacking) |





목표

HTTP 통신에 쓰이는 쿠키와 세션에 대한 이해



서론

현대의 웹 서비스는 대부분 로그인을 통해 마이페이지, 유료 서비스 등 개인만의 서비스를 이용합니다. 웹 서버는 수많은 클라이언트와 HTTP 프로토콜을 사용해 통신합니다. 손님 계정으로 로그인 했다면 손님이 이용할 수 있는 서비스를 제공하고, 관리자 계정으로 로그인 했다면 데이터베이스, 회원 관리 등의 관리자 페이지를 제공해야 합니다.

그렇다면 웹 서버는 수많은 클라이언트를 어떻게 구별하고 서로 다른 결과를 반환해줄까요? HTTP 프로토콜로 웹 서버와 통신할 때에는 웹 서버에 명령을 내리기 위해 GET, POST와 같은 메소드와 자원의 위치를 가리키는 URL 등이 포함되어 있습니다. 이외에도 **헤더(Header)**를 통해서 웹 서버에게 요청을 보내고, 웹 서버는 헤더를 읽고 클라이언트에게 결과 값을 반환합니다. 이때, 헤더에는 클라이언트의 정보와 요청의 내용을 구체화하는 등의 데이터가 포함되는데, 클라이언트의 인증 정보 또한 포함될 수 있습니다.







## 쿠키 🍪

클라이언트의 IP 주소와 User-Agent는 매번 변경될 수 있는 고유하지 않은 정보일 뿐만 아니라, HTTP 프로토콜의 **Connectionless**와 **Stateless** 특징 때문에 웹 서버는 클라이언트를 기억할 수 없습니다

**Connectionless, Stateless** 특성을 갖는 HTTP에서 상태를 유지하기 위해 **쿠키(Cookie)**가 탄생했습니다. 쿠키는 Key와 Value로 이뤄진 일종의 단위로, 서버가 클라이언트에게 쿠키를 발급하면, 클라이언트는 서버에 요청을 보낼 때마다 쿠키를 같이 전송합니다. 서버는 클라이언트의 요청에 포함된 쿠키를 확인해 클라이언트를 구분할 수 있습니다.



- **Connectionless**: 하나의 요청에 하나의 응답을 한 후 연결을 종료하는 것을 의미합니다. 특정 요청에 대한 연결은 이후의 요청과 이어지지 않고 새 요청이 있을 때 마다 항상 새로운 연결을 맺습니다.
- **Stateless**: 통신이 끝난 후 상태 정보를 저장하지 않는 것을 의미합니다. 이전 연결에서 사용한 데이터를 다른 연결에서 요구할 수 없습니다.



## 용도



일반적으로 쿠키는 클라이언트의 정보 기록과 상태 정보를 표현하는 용도로 사용합니다.





### **정보 기록**

웹 서비스 사용 시 종종 등장하는 팝업 창에 “다시 보지 않기”, “7일 간 표시하지 않기” 버튼이 있는 것을 확인할 수 있습니다. 웹 서버는 각 클라이언트의 팝업 옵션을 기억하기 위해 쿠키에 해당 정보를 기록하고, 쿠키를 통해 팝업 창 표시 여부를 판단합니다. 과거에는 클라이언트의 정보를 저장하기 위해 쿠키가 종종 사용됐습니다. 쿠키는 서버와 통신할 때마다 전송되기 때문에 쿠키가 필요 없는 요청을 보낼 때 리소스 낭비가 발생할 수 있습니다. 최근에는 이러한 단점을 보완하기 위해 Modern Storage APIs를 통해 데이터를 저장하는 방식을 권장하고 있습니다.

### **상태 정보**

많은 웹 사이트에서는 회원 가입과 로그인을 통해 개개인에게 맞춤형 서비스를 제공합니다. 웹 서버에서는 수많은 클라이언트의 로그인 상태와 이용자를 구별해야 하는데, 이때 클라이언트를 식별할 수 있는 값을 쿠키에 저장해 사용합니다.







## 쿠키가 없는 통신

다음은 앞서 설명한 HTTP 통신의 특징을 간략하게 표현한 그림입니다. 서버는 요청을 보낸 클라이언트가 누군지 알 수 없기 때문에 현재 어떤 클라이언트와 통신하는지 알 수 없습니다.

![img](https://kr.object.ncloudstorage.com/dreamhack-content/page/c0effc0ace75e4c7b84b4eb464816ab63be7bc54edda4bcbd962e76b10ca09c0.png)







## 쿠키가 있는 통신

다음은 쿠키를 사용해 HTTP 통신이 이뤄지는 과정을 간략하게 표현한 그림입니다. 클라이언트는 서버에 요청을 보낼 때마다 쿠키를 포함하고, 서버는 해당 쿠키를 통해 클라이언트를 식별합니다.

![img](https://kr.object.ncloudstorage.com/dreamhack-content/page/72609b4b5f11e2ffa47919ee11049884214de0c7e3ace9020565981f375d95ee.png)





## 쿠키 변조

중국집 식당에서 탕수육 이벤트를 쿠폰을 발행해 방문할 때 마다 도장을 찍어주는 방식으로 진행하고 있습니다. 도장은 식당이 찍어주지만 쿠폰은 손님이 보관하기 때문에 손님은 쿠폰을 마음대로 할 수 있습니다. 만약 나쁜 마음을 품은 손님이 식당에서 사용하는 도장과 비슷한 도장을 구해 직접 쿠폰에 가짜 도장을 찍게 된다면 식당에서 이를 구분할 방법이 없습니다.

쿠키는 클라이언트의 브라우저에 저장되고 요청에 포함되는 정보입니다. 따라서, 아래 예시처럼 **악의적인 클라이언트는 쿠키 정보를 변조해 서버에 요청**을 보낼 수 있습니다. 만약 서버가 별다른 검증 없이 쿠키를 통해 이용자의 인증 정보를 식별한다면 아래 그림과 같이 공격자가 타 이용자를 사칭해 정보를 탈취할 수 있습니다.

![img](https://kr.object.ncloudstorage.com/dreamhack-content/page/9f2f1c1cd169b77f68fc1119803a8297c9251a33751ef32ec16ef32816f33023.png)
